INTSourceChangelist:3206402
Availability:Public
Title:リターゲットされたアニメーションを使用する
Crumbs: %ROOT%, Engine, Engine\Animation, Engine\Animation\AnimHowTo
Description:複数キャラクターでリターゲットされたアニメーションをセットアップし、使用する方法例 
Related:Engine\Animation\AnimationRetargeting
Related:Engine\Animation\Skeleton
Related:Engine\Animation\Overview
version:4.14
skilllevel:Intermediate

**アニメーションのリターゲット** とは、既存のアニメーションを複数キャラクター間で再利用するプロセスです。キャラクター間で Animation アセットを共有できるため、完全に新しいアニメーションを作成する必要がなくなります。 

アニメーションのリターゲットには 2 種類あります。ひとつはアニメーションを共有したいキャラクターのスケルトンがもともとアニメーションが作成されたキャラクターと **同じスケルトン** を使用しているものです。 
もうひとつは **リグ** と呼ばれる中間オブジェクトを伴うものです。これは、あるキャラクターのスケルトンからアニメーションをリターゲットし、両方のスケルトンが共有するリグを使用してスケルトンのボーン情報を **別のスケルトン** に渡すものです。 

実行するアニメーション リターゲットのタイプについては、以下の 2 つのリンクを参照してください。 

[TOC(start:2 end:2)]

## 同じスケルトンを使用したリターゲット

このセクションでは、スケルトンを使用するすべての二足歩行キャラクターでリターゲットされたアニメーションを使用するために **スケルトン** をセットアップする方法を説明します。

### ステップ

1. **コンテンツ ブラウザ** で各キャラクターで使用されている **スケルトン** アセットを開きます。 

1.	**スケルトン エディタ** の **スケルトン ツリー** で **[Show Retargeting Options (リターゲット オプションを表示)]** チェックボックスにチェックを入れます。 

	![](HowTo1.png)

1.	 **スケルトン ツリー** の **ルート** ボーン上で **右クリック** して、 **[Recursively Set Translation Retargeting Skeleton (移動のリターゲットのスケルトンを再帰的に設定)]** を選択します。 

	![](HowTo2.png)

	これですべてのボーンがスケルトンの静的移動を確実に使用するようになります (以下で一部のボーンをリターゲット用に変更します)。 

1.	**Pelvis(骨盤)** ボーン (または同等のボーン) を探してドロップダウンボックスをクリックして **[AnimationScaled]** を選択します。 

	![](HowTo3.png)

	この操作は、ボーンが正しい高さに位置するようにしながら、アニメートされるようにするためのものです。移動をアニメートし、リターゲットしたいボーンが他にあれば、それらについてもこの設定を使用します。 

1.	**ルート** ボーン、 **IK** ボーン、使用する可能性のある **武器** のボーン、その他のマーカー スタイルのボーンを見つけて、それらを **アニメーション** に設定します。 

	![](HowTo4.png)

	**アニメーション** を [Bone Translation Retargeting (ボーンの移動のリターゲット)] モードとして使用することで、ボーンの移動はアニメーションのデータそのものから生じ、変更はされません。 

	[REGION:note]
	望ましい結果を得るには、異なるボーンで様々な方法を試してみる必要があるかもしれません。	
	[/REGION]

1.	ビューポートで **[Scene Setup]** ボタンをクリックし、別の **プレビュー メッシュ** を選択します。 

	![](HowTo5.png)

	異なる **スケルタルメッシュ** で別のアニメーションを試してみて各アニメーションでスケルトンが適切に設定されるようにします。 

1.	ビューポート内で **[Show]** をクリックして **[NonRetarget Animation]** にチェックを入れて、**[Bones]**で **[All Hierarchy]** を選んですべてのボーンを表示します。 

	![](HowTo6.png)

### 最終結果

以下の画面のようなスケルトンになるはずです。 

[INCLUDE:Engine\Animation\AnimationRetargeting#aftertable]

上の画面でベージュ部分はオリジナルのスケルトンで、現在、リターゲットされたスケルトンは白になります。リターゲットがキャラクターに適用されると、数式からプロポーションの違いをはじきだし、適用されたアニメーションが様々なキャラクター上で適切に再生されます。オリジナルのスケルトン (ベージュのスケルトン) は背の低いキャラクターと背の高いキャラクターの両方で同じ位置で表されます。 


## 異なるスケルトンを用いたリターゲット

このセクションでは、異なる Skeleton アセットを使用する、あるキャラクターから別のキャラクターにアニメーションをリターゲットするプロセスについて説明します。 
**マーケットプレイス** から無料で入手可能な 2 つのアセット パックも使用します。このアセットパックには、リターゲットに使用できるスケルトンとアニメーションが入っています。使用可能なスケルトン アセットを 2 つお持ちでそれを使う場合は、以下の注記をスキップし、そのアセットを使用してください。アセットの準備が整っていなかったら、以下の注記の 2 つのパックを追加する手順に従ってください。 

[REGION:note]
この例では、**マーケットプレイス** から無料で入手可能な以下のアセットを使用しています。

* 使用するソース スケルトンは **Animation Starter Pack** に入っている **UE4_Mannequin_Skeleton** です。 
* 使用するターゲット スケルトンは **Infinity Blade:Warriors** パックに入っている **SK_Mannequin_Skeleton** です。

上記のパックをインストールしたら、アンリアル ランチャーの **[Add to project (プロジェクトに追加)]** ボタンを使用してプロジェクトに追加することができます。 

![](AnimStarterPack.png)(w:300) ![](InfinityBladeWarriors.png)(w:300)
[/REGION]

### ステップ

1.	**コンテンツ ブラウザ** の **Game/AnimStarterPack/UE4_Mannequin/Mesh** フォルダで **UE4_Mannequin_Skeleton** アセットを開きます。 

	![](Retarget1.png)

1.	**[Retarget Manager (リターゲット マネージャ)]** ボタンをクリックします。**[Set up Rig]** で **[Select Rig]** ドロップダウンをクリックし、 **[Select Humanoid Rig]** を選択します。 

	![](Retarget2.png)

1.	**コンテンツ ブラウザ** の **Content/InfinityBladeWarriors/Character/CompleteCharacters** フォルダで **SK_Mannequin_Skeleton** アセットを開きます。

	![](Retarget3.png)

1.	**[Retarget Manager (リターゲット マネージャ)]** ボタンをクリックします。**[Set up Rig]** で **[Select Rig]** ドロップダウンをクリックし、 **[Select Humanoid Rig]** を選択します。

	![](Retarget4.png)

1.	リグを割り当てた状態で、次にターゲットのボーンをリグのノードと一致させる必要があります。 

	![](Retarget5.png)

	Infinity Blade:Warriors パックのスケルトンは、同じ命名規則とボーン階層を使っているため、自動的に検出されてリグに適用されます。 

	ボーンの命名規則がエピックのスケルトンと異なる場合は、リグの各ボーンに "none" と表示されます。 

	![](Retarget6.png)

	この場合、**Auto Mapping (自動マッピング)** 機能を使うか、スケルトンから各ボーンにリグ上のノードに最適にマッチするものを手動で割り当てる必要があります。 

	[REGION:tip]
	**Auto Mapping** 機能を使う場合、どのボーンがリグ上のどのノードに割り当てられているかをダブルチェックすると良いでしょう。 
	自動マッピングでは、ボーンの位置と命名規則に基づき最適にマッチするものを選んで、それらをリグ上のものに割り当てようとしますが、必ずしも各ケースで使用する理想的なボーンにはならないかもしれません。 
	[/REGION]

1.	 **[Show Advanced]** ボタンをクリックして、Advanced と Base のコンフィギュレーションを切り替えます。

	![](AdvancedConfig.png)

	このセクションでは、指の幅、IK ボーン、Twist/Roll ボーンに対するリグ上のノードに対応するスケルトンからボーンを割り当てます。 

	[REGION:note]
	ベース設定と同様に、Advanced 内のボーンは、設定しなければならないスケルトンに応じて "none" に設定されることがあります。 
	[/REGION]

1.	**コンテンツ ブラウザ** の **Content/AnimStarterPack** で、新規スケルトンにリターゲットするアニメーションを選択します。

1.	アニメーション上で **右クリック** して、**[Retarget Anim Assets -> Duplicate Anim Assets and Retarget]** の順序で選択します。 

	![](Retarget7.png)

1.	**[Select Skeleton (スケルトン選択)]** ウィンドウで、ウィンドウ上部にスケルトンが表示されます。それを選択し、**[Retarget]** をクリックします。 

	![](Retarget8.png)(w:840)

	これで指定したフォルダの場所にアニメーションがコピーされます。このウィンドウで新規アセット名を割り当てることもできます。 

	[REGION:note]
	**ターゲット** スケルトンには、可能な限り最適なリターゲット アニメーションを生成するために、ソースのものと類似したベース ポーズがあるはずです。
	上の図では両方のスケルトンが A-Pose です。しかし、A-Pose のキャラクターと T-Pose のキャラクターを持つ場合があるかもしれません。 
	これに対処するには、アニメーションをリターゲットする前に、 [リターゲットされたベース ポーズ](Engine/Animation/Persona/BasePoseManager) を使用することができます。 
	[/REGION]

### 最終結果

新規にリターゲットされたアニメーションは、アニメーションがリターゲットされた Skeleton アセットを使用するどのスケルタルメッシュでもを利用することができます。 

[OBJECT:EmbeddedVideo]
[PARAMLITERAL:width]
640
[/PARAMLITERAL]
[PARAMLITERAL:height]
360
[/PARAMLITERAL]
[PARAMLITERAL:videoid]
FKlniDMGxL4
[/PARAMLITERAL]
[/OBJECT]


この例では、アニメーションのリターゲット方法を示していますが、同じ **右クリック** の方法を任意のアニメーション アセットに使用してリターゲットを適用することができます。 
































