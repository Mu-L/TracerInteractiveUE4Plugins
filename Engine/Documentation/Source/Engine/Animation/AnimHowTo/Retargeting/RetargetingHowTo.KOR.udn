INTSourceChangelist:3206402
Availability: Public
Title:리타기팅된 애니메이션 사용하기
Crumbs: %ROOT%, Engine, Engine\Animation, Engine\Animation\AnimHowTo
Description:다수의 캐릭터에 리타기팅된 애니메이션을 셋업하고 사용하는 방법 예제입니다.
Related: Engine\Animation\AnimationRetargeting
Related: Engine\Animation\Skeleton
Related: Engine\Animation\Overview
version: 4.14
skilllevel: Intermediate

**애니메이션 리타기팅** 은 기존의 애니메이션을 다수의 캐릭터에 사용할 수 있도록 용도를 변경하는 프로세스로, 캐릭터 사이에 애니메이션 애셋을 공유하여 완전히 새로 만들 필요가 없어집니다.

애니메이션 리타기팅은 두 가지 형태가 있는데, 하나는 애니메이션을 공유하고자 하는 캐릭터의 스켈레톤이 원래 애니메이션을 제작했던 캐릭터와 **같은 스켈레톤** 을 사용하는 경우입니다. 
다른 경우는, **Rig** (릭)이라는 중간 오브젝트를 쓰는 방법인데, 한 캐릭터의 스켈레톤에서 만든 애니메이션을 리타기팅할 때 그 스켈레톤의 본 정보를 두 스켈레톤이 공유하는 릭을 사용하여 **다른 스켈레톤** 으로 전달하는 것입니다.

이루고자 하는 애니메이션 리타기팅 유형에 대해서는 아래 두 링크를 참고하세요:

[TOC(start:2 end:2)]

## 같은 스켈레톤을 사용하는 리타기팅

여기서는 스켈레톤을 사용하는 모든 바이페드 캐릭터에 대해 리타기팅된 애니메이션을 사용하도록 **스켈레톤** 셋업을 하는 법을 보여드리겠습니다.

### 단계

1.  **콘텐츠 브라우저** 안에서, 각 캐릭터에 사용되고 있는 **스켈레톤** 애셋을 엽니다.

1.	**스켈레톤 에디터** 의 **스켈레톤 트리** 창에서 **Show Retargeting Options** (리타기팅 옵션 표시) 박스를 체크합니다.

	![](HowTo1.png)

1.	**스켈레톤 트리** 에서 **루트** 본에 **우클릭** 한 다음 **Recursively Set Translation Retargeting Skeleton** (스켈레톤의 트랜슬레이션 리타기팅 재귀적 설정) 을 선택합니다. 

	![](HowTo2.png)

	그러면 모든 본이 스켈레톤의 고정 트랜슬레이션을 사용하도록 합니다 (잠시 후 특정 본에 대한 리타기팅을 변경하도록 하겠습니다).

1.	**Pelvis** (골반, 또는 그에 해당하는) 본을 찾은 다음 드롭다운 박스를 클릭하고 **AnimationScaled** (스케일 적용 애니메이션)을 선택합니다.

	![](HowTo3.png)

	그러면 본에 애니메이션이 적용되면서도 올바른 높이에 오도록 합니다. 다른 본에도 트랜슬레이션에 애니메이션과 리타기팅을 적용하려는 것이 있으면, 이 세팅을 사용해야 합니다.

1.	**루트** 본, **IK** 본, **Weapon** 본, 기타 마커 스타일 본이 있으면 **Animation** 으로 설정합니다.

	![](HowTo4.png)

	본 트랜슬레이션 리타기팅 모드를 **Animation** 으로 사용하면, 본의 트랜슬레이션은 애니메이션 데이터 자체를 바로 사용하여 변하지 않습니다.

	[REGION:note]
	다양한 본에 다양한 메서드로 실험해 보면서 원하는 결과가 날 때까지 시험해 봐야 할 수 있습니다.
	[/REGION]

1.	뷰포트의 **씬 구성** 버튼을 누르고 다른 **프리뷰 메시** 를 선택합니다.

	![](HowTo5.png)

	다른 **스켈레탈 메시** 에 다른 애니메이션을 시도하여 각 애니메이션에 대해 스켈레톤이 제대로 셋업되었는지 확인합니다.

1.	뷰포트에서 **표시** 를 클릭한 뒤 **NonRetarget Animation** (리타기팅되지 않은 애니메이션)을 체크하고, **본** 아래 **모든 계층구조** 를 선택하여 모든 본을 표시합니다.

	![](HowTo6.png)

### 최종 결과
	
스켈레톤에 아래와 비슷한 것이 보일 것입니다.

[INCLUDE:Engine\Animation\AnimationRetargeting#aftertable]

위에서 살색으로 표시된 부분은 원본 스켈레톤이고, 현재 리타기팅된 스켈레톤은 흰색으로 표시되어 있습니다. 캐릭터에 리타기팅이 적용되면, 등식을 통해 계산된 비율차가 적용된 애니메이션은 각기 다른 캐릭터에 제대로 재생되고, 원본 (살색) 스켈레톤은 단신 / 장신 캐릭터 양쪽에 같은 위치로 나타납니다.


## 다른 스켈레톤을 사용한 리타기팅

여기서는 각기 다른 스켈레톤 애셋을 사용하는 캐릭터끼리 애니메이션을 리타기팅하는 프로세스에 대해 살펴보겠습니다.
**마켓플레이스** 에서 무료로 받을 수 있는 애셋 팩 둘에는 리타기팅에 사용할 수 있는 스켈레톤과 애니메이션이 들어있습니다. 사용할 수 있는 스켈레톤 애셋이 둘 준비되어 있는 경우, 아래 참고 부분은 건너뛰어도 됩니다. 없는 경우, 아래 방법을 참고하여 두 팩을 추가해 주시기 바랍니다.

[REGION:note]
이 예제에서는 **마켓플레이스** 에서 무료로 받을 수 있는 애셋을 사용하는데, 다음과 같습니다:

* 소스 스켈레톤으로 사용하는 것은, **Animation Starter Pack** 에 포함된 **UE4_Mannequin_Skeleton** 입니다. 
* 타깃 스켈레톤으로 사용하는 것은, **Infinity Blade: Warriors** 팩에 포함된 **SK_Mannequin_Skeleton** 입니다.

위 팩들이 설치되었으면, 언리얼 언처의 **프로젝트에 추가** 버튼으로 프로젝트에 추가할 수 있습니다.

![](AnimStarterPack.png)(w:300) ![](InfinityBladeWarriors.png)(w:300)
[/REGION]

### 단계

1.	**콘텐츠 브라우저** 에서 **Content/AnimStarterPack/UE4_Mannequin/Mesh** 폴더 아래 **UE4_Mannequin_Skeleton** 애셋을 엽니다.

	![](Retarget1.png)

1.	**리타깃 매니저** 버튼을 클릭하고, **릭 구성** 아래 **릭 선택** 드롭다운을 선택한 뒤 **인간형 릭** 을 선택합니다.

	![](Retarget2.png)

1.	**콘텐츠 브라우저** 에서 **Content/InfinityBladeWarriors/Character/CompleteCharacters** 폴더 아래, **SK_Mannequin_Skeleton** 애셋을 엽니다.

	![](Retarget3.png)

1.	**리타깃 매니저** 버튼을 클릭한 뒤 **릭 구성** 아래 **릭 선택** 드롭다운을 클릭하고 **인간형 릭** 을 선택합니다.

	![](Retarget4.png)

1.	릭을 할당했으면, 타깃의 본을 릭의 노드와 맞춰줘야 합니다.

	![](Retarget5.png)

	Infinity Blade: Warriors 팩의 스켈레톤은 동일한 작명 규칙과 본 계층구조를 사용하므로, 자동 감지되어 릭에 적용됩니다.

	본 작명 규칙이 에픽 스켈레톤과 다른 경우, 릭의 본에 "none" (없음)으로 된 부분이 보일 것입니다:

	![](Retarget6.png)

	이 경우, **자동 매핑** 기능을 사용하거나, 스켈레톤의 각 본을 릭의 가장 잘 맞는 노드에 수동 할당해 줘야 합니다.

	[REGION:tip]
	**자동 매핑** 기능을 사용할 때, 어느 본이 릭의 어느 노드에 할당되었는지 다시 한 번 확인하는 것이 좋습니다.
	자동 매핑은 본 위치 및(또는) 본 작명 규칙에 따라 가장 잘 맞는 것을 골라 릭에 할당을 시도하지만, 상황에 따라 이상적인 본이 아닐 수 있습니다.
	[/REGION]
	
1.	**고급 표시** 버튼을 클릭하여 고급/기본 환경설정 전환이 가능합니다.

	![](AdvancedConfig.png)

	여기서는 열손가락, IK 본, 트위스트/롤 본에 대해서, 스켈레톤의 본을 릭의 노드에 맞춰줄 수 있습니다.

	[REGION:note]
	기본 환경설정과 비슷하게, 고급 환경설정의 본 역시 어느 스켈레톤에 설정했는가에 따라 "none" (없음)으로 설정될 수 있습니다.
	[/REGION]

1.	**콘텐츠 브라우저** 에서 **Content/AnimStarterPack** 아래, 새로운 스켈레톤에 리타기팅하고자 하는 애니메이션을 선택합니다.

1.	애니메이션에 **우클릭** 하고 **애님 애셋 리타깃 -> Duplicate Anim Assets and Retarget** (애님 애셋 복제 후 리타깃)을 선택합니다.

	![](Retarget7.png)

1.	**스켈레톤 선택** 창 윗부분에 스켈레톤이 보일 것입니다. 선택하고 **리타깃** 을 클릭합니다.

	![](Retarget8.png)(w:840)

	그러면 애니메이션이 지정된 폴더 위치에 복사됩니다. 이 창에서 새 애셋 이름도 할당해 줍니다.

	[REGION:note]
	**타깃** 스켈레톤에 소스 스켈레톤과 비슷한 베이스 포즈가 있어 최적의 리타기팅 애니메이션을 생성할 수 있을 것입니다.
	위에서 두 스켈레톤 모두 A 포즈이지만, A 포즈인 캐릭터와 T 포즈인 캐릭터도 있을 수 있습니다.
	그럴 때는 [리타기팅된 베이스 포즈](Engine/Animation/Persona/BasePoseManager) 를 사용하여 고친 후 애니메이션 리타기팅을 해주면 됩니다.
	[/REGION]

### 최종 결과

새로 리타기팅된 애니메이션은 애니메이션 리타기팅 대상 스켈레톤 애셋을 사용하는 스켈레탈 메시라면 어디든 사용할 수 있습니다.

[OBJECT:EmbeddedVideo]
[PARAMLITERAL:width]
640
[/PARAMLITERAL]
[PARAMLITERAL:height]
360
[/PARAMLITERAL]
[PARAMLITERAL:videoid]
FKlniDMGxL4
[/PARAMLITERAL]
[/OBJECT]


애니메이션 리타기팅 방법을 설명하는 예제긴 하지만, 어떤 애니메이션 애셋이든 똑같이 **우클릭** 하여 리타기팅을 적용할 수 있습니다.































