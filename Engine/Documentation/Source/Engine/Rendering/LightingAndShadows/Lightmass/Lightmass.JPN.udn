Availability:Public
Title:ライトマス グローバル イルミネーション
Crumbs: %ROOT%, Engine, Engine/Rendering/LightingAndShadows
Description:Lightmass の全機能と設定の概要
Version:4.9

[VAR:Topic]
[OBJECT:Topic]
	[PARAM:image]
		![%Engine/Rendering/LightingAndShadows/Lightmass:title%](%ROOT%/Engine/Rendering/LightingAndShadows/lighting_topic.png)
	[/PARAM]
	[PARAM:icon]
		![](%ROOT%/light_icon.png)(convert:false)
	[/PARAM]
	[PARAM:title]
		%Engine/Rendering/LightingAndShadows/Lightmass:title%
	[/PARAM]
	[PARAM:description]
		%Engine/Rendering/LightingAndShadows/Lightmass:description%
	[/PARAM]
	[PARAM:path]
		[RELATIVE:Engine/Rendering/LightingAndShadows/Lightmass]
	[/PARAM]
[/OBJECT]
[/VAR]

[REGION:fullwidth raw]
![](Engine/Rendering/LightingAndShadows/lighting_overview_banner_001.png)(convert:false)
[/REGION]

[TOC(start:2 end:2)]




[EXCERPT:LightMass_002]
**Lightmass** は、エリア シャドウイングやディフューズの相互反射のような光の複雑な相互作用を含むライトマップを作成します。固定および静的な可動性のある光の効果を事前計算するために使用します。 
[/EXCERPT:LightMass_002]

エディタと Lightmass 間の通信は **Swarm Agent** によって処理されます。Swarm はライティングのローカルビルドを管理する機能で、それをリモートマシンに分散することもできます。Swarm Agent はデフォルトでは最小化で開きます。ビルド処理の追跡も行い、現在作業中のマシン、作業の対象、それぞれが使用するスレッド数などに関する最新情報をレポートします。  

以下は Swarm Agent のサンプル画像です (下の方にあるバーは、ビルドの完成状況を示します)。

![](SwarmAgent.png)(w:640)

## Static Light (静的ライト) および Stationary Light (固定ライト) の機能

### ディフューズの相互反射

**ディフーズの相互反射** は、視覚的にも最も大切なグローバル イルミネーションのライティング エフェクトです。光はデフォルトで Lightmass によりバウンスし、全方向にバウンスする光の量 (と色) はマテリアルの基本色によって制御されます。このエフェクトはカラー ブリーディングと呼ばれることもあります。ディフューズの相互反射とは、入射光があらゆる方向に均等にバウンスすることであり、見る側の方向や位置に影響されません。

下の図は 1 つの平行光源で構成された Lightmass によりビルドされたシーンで、直接ライティングだけを表示しています。ライトで直接見えない範囲は黒くなっています。グローバル イルミネーションがない場合、このような結果になります。

![3DirectOnly.jpg](3DirectOnly.jpg)(w:720)

最初の拡散反射光のグローバル イルミネーション反射は、以下のようになります。左側の椅子の背後の影を見てください。これは直接ライティングの影なので、直接シャドウと呼ばれています。拡散反射の明るさと色は、入射光および入射光と相互作用するマテリアルのディフューズ項に依存します。光は跳ね返る (バウンスする) たび暗くなり、反射されずにサーフェスに吸収される場合もあります。下図では、柱の根元の方が直接光を受ける領域に近いので、間接光の量も他の表面より多くなっています。

![3FirstBounceOnly.jpg](3FirstBounceOnly.jpg)(w:720)

これは 2 回目の拡散反射です。光はさらに減衰され、より均等に分散されています。

![3SecondBounceOnly.jpg](3SecondBounceOnly.jpg)(w:720)

この図は 4 つの拡散反射を組み合わせたシーンです。フィルライトを手動で配置した場合と比べて、グローバル イルミネーションのシミュレーションはより複雑で、現実味を帯びたライティングを生み出します。特に間接シャドウはフィルライトでは実現できません。

![3FourBounces.jpg](3FourBounces.jpg)(w:720)


次の図からわかるように、跳ね返された光は下層にあるマテリアルのディフューズ色を受け取ります。これがカラー ブリーディングという言葉の由来です。カラー ブリーディングは、色が純色に近いほど分かりやすくなります。プリミティブ、マテリアルまたはレベルの DiffuseBoost を上げると、この効果をさらに誇張できます。

[REGION:imagetable]
| ![diffusebounce_T.JPG](diffusebounce_T.JPG)(h:445) | ![diffusebounce_L.JPG](diffusebounce_L.JPG)(h:445) |
| ------ | ------ |
| | |
[/REGION]


### キャラクターのライティング

Lightmass は [**Lightmass Importance Volume**](#LightmassImportanceVolume) 内の均一な 3D グリッドに低解像度でサンプルを配置し、キャラクターが歩くと予想される上向きのサーフェス上には、それより高い解像度でサンプルを配置します。各ライティング サンプルは、すべての方向からの間接ライティングはとらえますが、直接ライティングはとらえません。

最初のイメージは、床の上に置かれたライティング サンプルをデバッグ モードで可視化した画像で、2 番目のイメージは Lit モードの同じシーンです。赤いタペストリーの上方にあるサンプルが、赤いバウンス ライトをとらえているのが分かります。サンプルは単色で可視化されますが、実際にはあらゆる方向からの光をとらえます。

[REGION:imagetable]
| ![02CharacterLighting.jpg](02CharacterLighting.jpg)(w:465) | ![02CharacterLightingLit.jpg](02CharacterLightingLit.jpg)(w:465) |
| ------ | ------ |
| | |
[/REGION]


その後、間接ライティング キャッシュがこれらのライティング サンプルを使って、可動オブジェクトに対する間接光を補間します。間接ライティングはライト環境シャドウの色に影響し、方向には影響しません。[Show (表示)]-> [Visualize (可視化)] -> [Volume Lighting Samples] を使えばビューポートでプレビューできます。

詳細は、 [間接ライティング キャッシュ](Engine/Rendering/LightingAndShadows/IndirectLightingCache) ページを参照してください。

#### 制限事項

   * ボリューム サンプル配置をデフォルト設定にすると、大きなマップに大量のサンプルが作られます。これにより、間接ライティング キャッシュ補間の回数が非常に多くなります。StaticLightingLevelScale を使って、大きいマップのサンプル数を減らします。
   * LightmassImportanceVolume 外の可動オブジェクトには、黒い間接ライティングが与えられます。


### アンビエント オクルージョン (AO)

Lightmass は詳細な間接シャドウを自動的に計算しますが、芸術的な目的で、またはシーン内の近接感覚を強調するために、間接シャドウを誇張すると効果があがることがあります。  

アンビエント オクルージョン (AO) とは、均等に明るい上半球から得られる間接シャドウイングのことで、雲に覆われた空のようなものです。Lightmass はアンビエント オクルージョンの計算をサポートし、それを直接 / 間接ライティングに適用してライトマップにベイクします。アンビエント オクルージョンはデフォルトでは有効に設定されています。無効にするためには、[World Settings (ワールド設定)] の [Lightmass (ライトマス)] の [Lightmass Settings (ライトマス設定)] の[Use Ambient Occlusion (アンビエントオクルージョンを使う)] のチェックを外します。

最初のイメージは、間接ライティングを使用するシーンですが、アンビエント オクルージョンが適用されていません。2 番目のイメージでは同じシーンで、直接および間接ライティングの両方にアンビエント オクルージョンが適用されています。オブジェクトが引っ付いているところが暗くなっているのが分かります。

[REGION:imagetable]
![9NoAO.jpg](9NoAO.jpg)(w:465) | ![9WithAO.jpg](9WithAO.jpg)(w:465) |
| ------ | ------ |
| アンビエントオクルージョンなし | アンビエントオクルージョンあり |
[/REGION]

#### アンビエント オクルージョンの設定

| プロパティ | 説明 |
| ------- | ------------ |
| **Visualize Ambient Occlusion** | ライティングのビルド時に、ライトマップをオクルージョン係数でオーバーライドします。オクルージョン係数がどのようなものであるか確認したいときや、設定値を変えてその効果を比較したいときに便利です。|
| **Max Occlusion Distance** | オブジェクトへの距離を最小にすることで、もう 1 つのオブジェクト上にオクルージョンが発生します。 |
| **Fully Occluded Samples Fraction** | 完全なオクルージョンに達するために遮へいしなければならないサンプル数の割合。プリミティブ単位の FullyOccludedSamplesFraction もあるので注意してください。これにより、オブジェクトによって別のオブジェクトに発生するオクルージョンの量を調整できます。 |
| **Occlusion Exponent** | 指数が高いほどコントラストも大きくなります。 |

[REGION:imagetable]
| ![92Defaults.jpg](92Defaults.jpg)(w:230) | ![92MaxDist5.jpg](92MaxDist5.jpg)(w:230) | ![92MaxPct80.jpg](92MaxPct80.jpg)(w:230) | ![92Exponent2.jpg](92Exponent2.jpg)(w:230) |
| ------ | ------ | ------ | ------ |
| デフォルトの AO 設定 (MaxOcclusionDistance = 200, FullyOccludedSamplesFraction = 1.0, OcclusionExponent = 1.0) | MaxOcclusionDistance = 5。低周波のオクルージョンが消え、コーナー部分のオクルージョンだけ残ります。 | FullyOccludedSamplesFraction = 0.8。オクルージョンはすべての帯域で暗く変化し、80% 以上遮へいされていた範囲はサチュレートして完全に黒くなります。| OcclusionExponent = 2。オクルージョンは中間域から急速に飽和して暗くなり、コーナー部分に影だまりができます。|
[/REGION]


NumIndirectLightingBounces が 0 より大きい時、ライティングのビルドに関しては AO の負荷はほとんどありません。

#### 制限事項

   * アンビエント オクルージョンの場合、コーナー部分で急激に変化するので、適切に見えるようにライトマップ解像度をかなり高くする必要があります。 
   * アンビエント オクルージョンには高密度のライティング サンプルが必要なので (間接シャドウと同様に)、プレビュー品質のビルドで AO をプレビューするのはあまりよいことではありません。


### マスクされたシャドウ

Lightmass は、BLEND_Masked マテリアルの不透明マスクをシャドウの計算に含めます。エディタのビューポートでクリップされるマテリアル部分からは、影が生まれません。これを利用して、ツリーやフォリッジからより詳細な影を生み出すことができます。

[REGION:imagetable]
| ![masked.JPG](masked.JPG)(h:420) | ![masked_L.JPG](masked_L.JPG)(h:420) |
| ------ | ------ |
| | |
[/REGION]

## Stationary Light (固定ライト) のみの機能

### Bent Normal (ベント法線) によるスカイ オクルージョン

Lightmass は、Stationary Mobility (固定可動性) が設定された [**スカイライト**](Engine/Rendering/LightingAndShadows/LightTypes/SkyLight) が有効化されると、ベント法線の形で指向性オクルージョンを作成します。  

### ディスタンス フィールド シャドウマップ

Lightmass は [**Stationary Light**](Engine/Rendering/LightingAndShadows/LightMobility/StationaryLights) に対してディスタンス フィールド シャドウマップを計算します。低解像度の場合でも、ディスタンス フィールド シャドウマップはカーブ形状を非常によく維持しますが、エリア シャドウイングあるいは透過シャドウをサポートしません。

## Static Light (静的ライト) 限定の機能

### エリア ライトとシャドウ

ライトマスでは、静的可動性のあるすべてのライトのデフォルトはエリア ライト (面照明) です。Point Light (ポイントライト) と Spot Light (スポットライト) の光源は球体を使用します。その半径は [Lightmass Settings (ライトマス設定)] の [Light Source Radius (光源の半径)] で設定します。 平行光源は、シーンの端に位置するディスク (円盤) を使用します。光源のサイズは影の柔らかさを制御する 2 つの要因の 1 つで、光源が大きいほど柔らかな影になります。もう 1 つの要因は、影を受けるオブジェクトの位置から投影するオブジェクトまでの距離です。現実世界と同様に、この距離が大きいほどエリア シャドウは柔らかになります。

最初のイメージは静的な光源のみを使用する静的な平行光源で、半暗部のサイズはどこも同じです。2 番目のイメージでは、ライトマスがエリア シャドウを計算し、光源のサイズとオクルーダの距離によって線明度が調整されています。グラウンドに近い位置ほど、柱の影がより鮮明なのがわかります。

[REGION:imagetable]
| ![7OldUE3Shadows.jpg](7OldUE3Shadows.jpg)(h:520) | ![7LightmassShadows.jpg](7LightmassShadows.jpg)(h:520) |
| ------ | ------ |
| | |
[/REGION]

ポイント ライトとスポット ライトの光源半径は、黄色のワイヤーフレームで描かれ、影響半径はティール (緑がかった青) で描かれます。シャドウ キャスティング ジオメトリと交差していないこと、またはライトがそのジオメトリの両側で光を放つこと、この 2 点をほとんどの場合に確認しておくことをお勧めします。

![](AreaLight.png)

### 透過シャドウ

光が透過マテリアルライトを通過し、静的シャドウを投影するメッシュに適用されると、エネルギーをいくらか失い、透過シャドウとなります。  

![translucent_T.JPG](translucent_T.JPG)(h:400)


#### 透過シャドウの色

マテリアルを通過する光の量は Transmission と呼ばれ、カラーチャンネルごとに 0 から 1 の範囲で定められます。値が 0 の場合は完全に不透明で、1 は入射光がマテリアルの影響を受けずに通過することを意味します。Transmission にはマテリアルデータが直接提供されず、現在は以下に示す他のマテリアル値からこれを求めています。

* Lit 状態のマテリアル
	* BLEND_Translucent と BLEND_Additive:Transmission = Lerp(White, BaseColor, Opacity)
	* BLEND_Modulate:Transmission = BaseColor
* Unlit materials
	* BLEND_Translucent と BLEND_Additive:Transmission = Lerp(White, Emissive, Opacity)
	* BLEND_Modulate:Transmission = Emissive

これは、不透明度 (Opacity) が 0 の場合、マテリアルは入射光にフィルタをかけず、透過シャドウがない、ということになります。不透明度が 1 の場合、入射光はマテリアルのエミッシブまたは基本色 (マテリアルのリット状態に応じて) によってフィルタされます。間接ライティングによって透過シャドウが色褪せてしまい、透過マテリアルのエミッシブまたはディフューズよりも彩度が低くなることがあるので注意してください。

#### 透過シャドウの鮮明度

透過シャドウはいくつかの要因により鮮明度が左右されます。

最初のイメージは、大きな光源を使用し (LightSourceAngle が 5 の平行ライト) 、2 番目のイメージは、小さな光源を使用しています (LightSourceAngle が 0) 。

[REGION:imagetable]
| ![5LargeLightSource.jpg](5LargeLightSource.jpg)(h:560) | ![5SmallLightSource.jpg](5SmallLightSource.jpg)(h:560) |
| ------ | ------ |
| | |
[/REGION]

最初のイメージは、左側で小さな光源を使用していますが、ライトマップ解像度が低すぎて透過シャドウをとらえることができません。2 番目のイメージでは、マテリアルの読み出し時の解像度 (マテリアル エディタ の ExportResolutionScale で制御します) が低すぎたので、鮮明な影をとらえていません。

[REGION:imagetable]
| ![5LowLightmapResolution.jpg](5LowLightmapResolution.jpg)(h:565) | ![5LowExportResolutionScale.jpg](5LowExportResolutionScale.jpg)(h:565) |
| ------ | ------ |
| | |
[/REGION]

間接ライトも透過マテリアルの影響を受けます。この画像の窓は、その Transmission に基づいて入射光をフィルタし、窓を通過した光はその色を変えてシーンの周辺に反射しています。

![TranslucentShadowIndirectLight.jpg](TranslucentShadowIndirectLight.jpg)


#### 制限事項

   * **透過マテリアル** は、現在は光を拡散しないので、周辺オブジェクトへの色の染み出しはありません。 
   * 最初の拡散反射は、現在のところ透過シャドウの影響を受けません。これは、最初のバウンス間接光が透過マテリアルを通過するときには、そのマテリアルの **Transmission** によってフィルタされないことを意味します。
   * 反射 (Transmission からのコースティック) は現在サポートされていません。

## Lightmass を使って最高の品質を得るには

### ライティングを際立たせる

#### ディフューズ テクスチャ

レンダリングの際に、光があたるピクセルの色は BaseColor * Lighting と判定され、ライティングの視認レベルに基本色が直接影響を及ぼします。コントラストが高い場合、またはディフューズ テクスチャが暗い場合はライティングを識別しにくく、コントラストが低い場合や中間域のディフューズ テクスチャの場合にはライティングを通してディテールが見えます。

最初のイメージ (中間域のディフューズテクスチャを使用) と、2 番目のイメージ (これもライトマスを適用してビルドされていますが、暗くて「うるさい (線がごちゃごちゃしている)」テクスチャを使用) で、ライティングの透明度を比較してみてください。2 番目のイメージでは、影の変わり目のような周波の最も高い変化しか認識できません。 

[REGION:imagetable]
![94MidToneDiffuse.jpg](94MidToneDiffuse.jpg)(w:465) | ![94DarkDiffuse.jpg](94DarkDiffuse.jpg)(w:465) |
| ------ | ------ |
| | |
[/REGION]

**ディフューズ** 項を確認するには、表示モードを Unlit ビューモードにすると便利です。Unlit ビューモードでは、最初のイメージは平坦でより単調に見えます。ということは、このシーンではすべての照明作業が (ディフューズではなく) ライティングから発生し、ピクセルの最終的な色の変化は、その大半がライティングの差異によるものである、と判断できます。 良いライティングを得るためには、 Unlit ビューモードでシーンはフラットで味気なく見えていなければなりません。ライティングとマクロ機能をディフューズ テクスチャにベイクするとライティングが妨げられます。

[REGION:imagetable]
![94MidToneDiffuseUnlit.jpg](94MidToneDiffuseUnlit.jpg)(w:465) | ![94DarkDiffuseUnlit.jpg](94DarkDiffuseUnlit.jpg)(w:465) |
| ------ | ------ |
| | |
[/REGION]


Unlit の画像の数か所でエディタのカラー ピッカーを使い、左のシーンのディフューズ値は 0.5 前後で、右のシーンのディフューズ値は 0.08 前後であると確認しました。Photoshop を使ってこれらのアンリット画像のヒストグラムを 調べると、ディフューズ テクスチャの分布が良く分かります。  

[REGION:note]
Photoshop はガンマ空間でカラー値を示すため、 127 (.5) ではなく 186 (.73) が、実際の黒と白の中間値を示します。左側の図が、ライティングがはっきりと視認できる画像のヒストグラムです。
[/REGION]

![hist_Spo.jpg](hist_Spo.jpg)
![hist_UT.jpg](hist_UT.jpg)


#### ライティングの設定

   * アンビエント ライティングを避けてください！アンビエント キューブマップのようなアンビエント ライティングは一定値のアンビエント項をレベルに加算し、光が間接的にあたる領域のコントラストを低くします。  
   * 光が直接あたる領域と、間接的にあたる領域間のコントラストが高くなるようにライトを設定します。コントラストによって影との変わり目を簡単に際立たせ、レベルに心地よい奥行き感を与えます。
   * 明るい部分が明るくなりすぎず、暗い部分は真っ暗ではなく、ディテールをまだ視認できるようにライトを設定します。仕上げの画面で必ず暗い部分をチェックしてください。

### ライティングの品質改善

#### ライトマップ解像度

詳細で高品質のライティングを行うには、高解像度のテクスチャ ライトマップを使用するのが一番です。ただしこれはトレードオフで、ライトマップ解像度が高くなればテクスチャ メモリの使用量が増えるので、ビルド時間がかかるというマイナス面が発生します。理想的には、視覚的に高い影響を及ぼす周辺と、高周波シャドウが存在する場所にライトマップ解像度の大部分を割り当てるようにします。  

#### ライトマス ソルバーの品質

**ライトマス ソルバー** の設定は、 [Lighting Build Options] ダイアログで指定するビルド品質に基づいて、自動的に設定されます。Production (プロダクション品質) では、ディフューズ テクスチャが適用されて、アーチファクトがほぼ目立たず、十分に良い品質が得られます。  

## ライティングのビルド時間を改善方法

Lightmass のビルド時間を改善する方法はいくつかあります。

   * 高解像度のライトマップは、高周波 (急激に変化する) ライティングがある範囲のみに使用して、間接ライティングを受けない、または激しい間接シャドウの影響を受けないブラシ サーフェスと静的メッシュではライトマップ解像度を低くすることで、一番目立つところに高解像度シャドウが得られます。
   * プレーヤーから見えないサーフェスでは、ライトマップ解像度を可能な範囲で低く設定します。
   * [Lightmass Importance Volume](#LightmassImportanceVolume) を使い、最も重要な部分 (プレイ可能部分の周辺) を包囲します。
   * マップ全体のライトマップ解像度を最適化して、メッシュのビルド時間を均一にします。分散ビルドに何台マシンを使っても、ライティングのビルドには、最も遅い 1 つのオブジェクトのビルドよりも時間がかかります。つなげてメッシュを大きくしないようにしてください。レベルの範囲が大きくなり、ライトマップ解像度が高くなってしまいます。モジュラー ピースに分割すれば、特にコアの多いマシン上ではビルド時間が改善されます。
   * セルフ オクルージョンが多いメッシュはビルドに時間がかかります。例えば、平行したレイヤーの多いラグはフラットな床よりもビルドに時間がかかります。

**[Lighting Build Info]** ダイアログは、ライティング ビルド時間の改善のために非常に重要なツールです。まず、統計をを見たいレベル内にライティングをビルドします。次に *Build->Lighting Info->Lighting StaticMesh Info* からダイアログを開きます。ドロップダウンを *Lighting Build Info* に変更します。これにより、ソートされたメッシュのリストとライティングの計算に必要な時間が表示されます。

![](LightingBuildInfo.png)

## Lightmann の設定

### Lightmass Importance Volume

[EXCERPT:LightMass_001]
マップの多くは、エディタのグリッドの端までメッシュが広がっていますが、高品質のライティングが必要な実際のプレイ可能エリアはそれよりずっと小さなものです。Lightmass はレベルのサイズに基づいて光子 (photon) を放つので、背景のメッシュでは必要な光子の数が大幅に増えて、ライティングのビルドにも時間がかかります。Lightmass Importance Volume は、Lightmass が光子を放つ面積を調整し、詳細な間接ライティングが必要な領域だけに集中させることができます。現在はこのボリュームの外側には間接ライティングはありませんが、これを修正し、外側が低品質の間接ライティングになるようにする予定です。
[/EXCERPT:LightMass_001]

最初の図では、マルチプレイヤー マップのオーバーヘッド ワイヤーフレーム ビューが表示されます。高品質のライティングが必要な実際のプレイ可能エリアは、中央の小さなグリーンのかたまりです。  

2 番目の画像は、 **Lightmass Importance Volume** が正しく設定されたマルチプレイヤー マップのプレイ可能エリアの拡大図です。Lightmass Importance Volume によってライトの半径が 80,000 ユニットから 10,000 ユニットに縮小され、照明面積が 64 分の 1 になります。

[REGION:imagetable]
![JacintoImportanceFar.jpg](JacintoImportanceFar.jpg)(w:465) | ![JacintoImportanceNear.jpg](JacintoImportanceNear.jpg)(w:465) |
| ------ | ------ |
| | |
[/REGION]

[EXCERPT:LightMass_003]
Lightmass Importance Volume をレベルに追加するには、 **[Modes]** メニューの **[Volumes]** タブから **Lightmass Importance Volume** オブジェクトをレベルの中にドラッグして必要なサイズにスケーリングします。

![](AddingLightMassVolume.png)(w:840)

または、アクタ の中にある [Details (詳細)] パネルの **[Convert Actor (アクタを変換)]** ドロップダウン ボックスをクリックして **Lightmass Importance Volume** へ **ブラシ** を変換する方法もあります。

![](ConvertBrush_Actor.png)

ドロップダウン ボックスをクリックすると、ブラシに置き換えるアクタのタイプを選択するメニューが表示されます。

![](ConvertBrush_LightMassVol.png)

Lightmass Importance Volume を複数配置した場合、ライティング作業のほとんどはそれらを全て含むバウンディング ボックスを使って行われます。ただし、 Volume Lighting のサンプル は小さめのボリュームの内部にのみ配置されます。
[/EXCERPT:LightMass_003]

### ワールド設定 

ライトマスは **[World Settings (ワールド設定)]** ウィンドウの **[Lightmass]** セクションで調整できます。 

![worldlightmasssettings.png](worldlightmasssettings.png)

メインの **ツールバー** の ![](WorldSettings_Icon.png) アイコンをクリックすると **[World Settings]** にアクセスできます。

| プロパティ | 説明 |
| ------- | ------------ |
| **Force No Precomputed Lighting** | レベルに動的ライティングを使用させて、基本的にライトとシャドウマップを作成する Lightmass 機能を非アクティブにします。 |
| **Static Lighting Level Scale** | エンジンのスケールに相対的なレベルのスケール、つまり 1 アンリアル単位 == 1 センチです。これは、ライティングで計算するディテールの量を決定するのに使われ、値が小さいほどビルド時間が増大します。レベルが巨大な場合は、2 または 4 あたりの大きめのスケールでビルド時間を縮めることができます。 |
| **Num Indirect Lighting Bounces** | 光源から始まった光が、サーフェスから跳ね返る (バウンスする) ことができる回数。0 は直接ライティングのみ、1 は反射 1 回、と続きます。1 回目のバウンスの計算時間が最も長く、2 回目がそれに続きます。それ以降のバウンスではほぼ無しに等しく、追加する光の量も非常に少なく、バウンスのたびに減衰します。 |
| **Indirect Lighting Quality** | Lightmass GI ソルバが使用するサンプル数をスケールします。設定を高くすればするほど長いビルド時間で生じるソルバ アーティファクト (ノイズ、汚れ) が少なくなります。ライトマップを使用したことによるアーティファクト (テクスチャのシーム、圧縮によるアーティファクト、テクセル形状) には影響しないことに留意してください。 |
| **Indirect Lighting Smoothness** | 値が高いほど間接ライティングが滑らかになります。その結果、ソルバ ノイズを隠すことはできますが、詳細な間接シャドウとアンビエント オクルージョンも失うことになります。最高の品質のために増加した *Indirect Lighting Quality* を若干下げる (.66 または .75) 場合に便利です。 |
| **Environment Color** | シーンから外れた放射光に移る色。環境は、レベルを包囲する球体として可視化され、このカラーの光を全方向に放ちます。 |
| **Environment Intensity** | Environment Color をスケーリングして HDR の環境色を表現します。 |
| **Diffuse Boost** | シーン内のすべてのマテリアルのディフューズ寄与分をスケーリングします。DiffuseBoost を増やすことで、シーンの間接ライティングの強度を効率的に上げることができます。DiffuseBoost が適用された後、マテリアルのエネルギーを節約するためにディフューズ項は 1.0 の明るさに固定されます (つまり、バウンスのたびに光が増えるのではなく、減ることを意味します)。DiffuseBoost を上げても間接ライティングが明るくならない場合は、ディフューズ項は固定されているので、代わりにライトの IndirectLightingScale で 間接ライティングを増やす必要があります。 |
| **Use Ambient Occlusion** | 静的アンビエント オクルージョンが Lightmass を使って計算され、ライトマップにビルドされるようにします。 |
| **Direct Illumination Occlusion Fraction** | 直接ライティングに適用される AO の量。 |
| **Indirect Illumination Occlusion Fraction** | 間接ライティングに適用される AO の量。|
| **Occlusion Exponent** | 指数が高いほどコントラストも大きくなります。 |
| **Fully Occluded Samples Fraction** | 完全なオクルージョンに達するために遮へいしなければならないサンプル数の割合。|
| **Max Occlusion Distance** | オブジェクトへの距離を最小にすることで、もう 1 つのオブジェクト上にオクルージョンが発生します。 |
| **Visualize Material Diffuse** | 通常の直接 / 間接ライティングをオーバーライドし、 Lightmass に格納するマテリア ディフューズ項だけ可視化します。これは、ライトマスに格納されるマテリアルのディフューズが、実際のディフューズと調和するかどうかを確認するときに便利です。 |
| **Visualize Ambient Occlusion** | 通常の直接 / 間接ライティングを無効にし、 AO 項だけを可視化します。オクルージョン項だけ取り出すので、アンビエント オクルージョンの設定を調整するときに便利です。|
| **Level Lighting Quality** | 現在のレベル ライティング ビルドの品質設定を反映します。|

### ライトの設定

以下は、[Lightmass] セクションのライトのプロパティの中で調整できるライトマス設定です。 

![LightLightmassSettings.png](LightLightmassSettings.png)

| プロパティ | 説明 |
| ------- | ------------ |
| **Indirect Lighting Saturation** | 0 の場合、間接ライティングの彩度が完全に下がり、1 では変化がありません。 |
| **Shadow Exponent** | シャドウの半影のフォールオフ、つまり完全なリット状態から完全に影で覆われている状態まで変化する速度を制御します。 |
| **Light Source Angle** |  **Directional Lights Only** の場合、ライトのエミッシブなサーフェスがレシーバーに相対して広がる角度です。暗部のサイズに影響します。 |


### プリミティブ コンポーネントの設定

以下は、[Modes] メニューの **[Geometry]** タブから追加した **[Brush]** で調整できる **ライトマス** です。これらは、 **[Brush]** の **[Details (詳細)]** パネルにあります。 

![objectlightmasssettings.png](objectlightmasssettings.png)

| プロパティ | 説明 |
| ------- | ------------ |
| **Diffuse Boost** | このオブジェクトに適用される、すべてのマテリアルのディフューズ寄与分をスケーリングします。 |
| **Fully Occluded Samples Fraction** | 他のオブジェクト上で完全なオクルージョンに達するために、このオブジェクトから遮へいしなければならない AO サンプル数の割合。これを使い、このオブジェクにより他のオブジェクト上にできるオクルージョンの量を制御することができます。 |
| **Shadow Indirect Only** | これを選択した場合、このオブジェクトは間接ライティングのみ影を付けます。この設定は、草原など、レンダリングするジオメトリが実際のジオメトリ表現だけで正確に加工した影を付ける必要がなく、影を生成しても、周波数が高すぎて事前計算するライトマップに保存できない場合に便利です。 |
| **Use Two Sided Lighting** | これを選択した場合、このオブジェクトはポリゴンの両側から光を受けたように照らされます。 |


### 基本マテリアル設定
以下は、[Details (詳細)] パネルの Base Node 用マテリアルで調整できる **Lightmass** 設定です。 

マテリアル エディタ の情報に関しては、[マテリアル エディタ ユーザー ガイド](Engine/Rendering/Materials/Editor) をご覧ください。

![materialsettings.png](materialsettings.png)

| プロパティ | 説明 |
| ------- | ------------ |
| **Cast Shadow as Masked** | 透過マテリアルの場合、シャドウ キャスティングの目的でマスクしているかのようにマテリアルを取り扱います。|
| **Diffuse Boost** |静的ライティングに対する、このマテリアルのディフューズ寄与分をスケーリングします。| 
| **Export Resolution Scale** | このマテリアルの属性を読み出してライトマスに格納するときの解像度をスケーリングします。詳細が必要な場合にこれを利用して、マテリアル解像度を上げることができます。|


