#
# Build PhysX (PROJECT not SOLUTION) common
#

SET(PHYSX_HEADERS
	${PHYSX_ROOT_DIR}/Include/PxActor.h
	${PHYSX_ROOT_DIR}/Include/PxAggregate.h
	${PHYSX_ROOT_DIR}/Include/PxArticulation.h
	${PHYSX_ROOT_DIR}/Include/PxArticulationJoint.h
	${PHYSX_ROOT_DIR}/Include/PxArticulationLink.h
	${PHYSX_ROOT_DIR}/Include/PxBatchQuery.h
	${PHYSX_ROOT_DIR}/Include/PxBatchQueryDesc.h
	${PHYSX_ROOT_DIR}/Include/PxBroadPhase.h
	${PHYSX_ROOT_DIR}/Include/PxClient.h
	${PHYSX_ROOT_DIR}/Include/PxConstraint.h
	${PHYSX_ROOT_DIR}/Include/PxConstraintDesc.h
	${PHYSX_ROOT_DIR}/Include/PxContact.h
	${PHYSX_ROOT_DIR}/Include/PxContactModifyCallback.h
	${PHYSX_ROOT_DIR}/Include/PxDeletionListener.h
	${PHYSX_ROOT_DIR}/Include/PxFiltering.h
	${PHYSX_ROOT_DIR}/Include/PxForceMode.h
	${PHYSX_ROOT_DIR}/Include/PxImmediateMode.h
	${PHYSX_ROOT_DIR}/Include/PxLockedData.h
	${PHYSX_ROOT_DIR}/Include/PxMaterial.h
	${PHYSX_ROOT_DIR}/Include/PxPhysics.h
	${PHYSX_ROOT_DIR}/Include/PxPhysicsAPI.h
	${PHYSX_ROOT_DIR}/Include/PxPhysicsSerialization.h
	${PHYSX_ROOT_DIR}/Include/PxPhysicsVersion.h
	${PHYSX_ROOT_DIR}/Include/PxPhysXConfig.h
	${PHYSX_ROOT_DIR}/Include/PxPruningStructure.h
	${PHYSX_ROOT_DIR}/Include/PxQueryFiltering.h
	${PHYSX_ROOT_DIR}/Include/PxQueryReport.h
	${PHYSX_ROOT_DIR}/Include/PxRigidActor.h
	${PHYSX_ROOT_DIR}/Include/PxRigidBody.h
	${PHYSX_ROOT_DIR}/Include/PxRigidDynamic.h
	${PHYSX_ROOT_DIR}/Include/PxRigidStatic.h
	${PHYSX_ROOT_DIR}/Include/PxScene.h
	${PHYSX_ROOT_DIR}/Include/PxSceneDesc.h
	${PHYSX_ROOT_DIR}/Include/PxSceneLock.h
	${PHYSX_ROOT_DIR}/Include/PxShape.h
	${PHYSX_ROOT_DIR}/Include/PxSimulationEventCallback.h
	${PHYSX_ROOT_DIR}/Include/PxSimulationStatistics.h
	${PHYSX_ROOT_DIR}/Include/PxSpatialIndex.h
	${PHYSX_ROOT_DIR}/Include/PxVisualizationParameter.h
	${PHYSX_ROOT_DIR}/Include/PxVolumeCache.h
)
SOURCE_GROUP(include FILES ${PHYSX_HEADERS})

SET(PHYSX_CLOTH_HEADERS
	${PHYSX_ROOT_DIR}/Include/cloth/PxCloth.h
	${PHYSX_ROOT_DIR}/Include/cloth/PxClothCollisionData.h
	${PHYSX_ROOT_DIR}/Include/cloth/PxClothFabric.h
	${PHYSX_ROOT_DIR}/Include/cloth/PxClothParticleData.h
	${PHYSX_ROOT_DIR}/Include/cloth/PxClothTypes.h
)
SOURCE_GROUP(include\\cloth FILES ${PHYSX_CLOTH_HEADERS})

SET(PHYSX_COMMON_HEADERS
	${PHYSX_ROOT_DIR}/Include/common/PxBase.h
	${PHYSX_ROOT_DIR}/Include/common/PxCollection.h
	${PHYSX_ROOT_DIR}/Include/common/PxCoreUtilityTypes.h
	${PHYSX_ROOT_DIR}/Include/common/PxMetaData.h
	${PHYSX_ROOT_DIR}/Include/common/PxMetaDataFlags.h
	${PHYSX_ROOT_DIR}/Include/common/PxPhysicsInsertionCallback.h
	${PHYSX_ROOT_DIR}/Include/common/PxPhysXCommonConfig.h
	${PHYSX_ROOT_DIR}/Include/common/PxRenderBuffer.h
	${PHYSX_ROOT_DIR}/Include/common/PxSerialFramework.h
	${PHYSX_ROOT_DIR}/Include/common/PxSerializer.h
	${PHYSX_ROOT_DIR}/Include/common/PxStringTable.h
	${PHYSX_ROOT_DIR}/Include/common/PxTolerancesScale.h
	${PHYSX_ROOT_DIR}/Include/common/PxTypeInfo.h
)
SOURCE_GROUP(include\\common FILES ${PHYSX_COMMON_HEADERS})

SET(PHYSX_PARTICLES_HEADERS
	${PHYSX_ROOT_DIR}/Include/particles/PxParticleBase.h
	${PHYSX_ROOT_DIR}/Include/particles/PxParticleBaseFlag.h
	${PHYSX_ROOT_DIR}/Include/particles/PxParticleCreationData.h
	${PHYSX_ROOT_DIR}/Include/particles/PxParticleFlag.h
	${PHYSX_ROOT_DIR}/Include/particles/PxParticleFluid.h
	${PHYSX_ROOT_DIR}/Include/particles/PxParticleFluidReadData.h
	${PHYSX_ROOT_DIR}/Include/particles/PxParticleReadData.h
	${PHYSX_ROOT_DIR}/Include/particles/PxParticleSystem.h
)
SOURCE_GROUP(include\\particles FILES ${PHYSX_PARTICLES_HEADERS})

SET(PHYSX_PVD_HEADERS
	${PHYSX_ROOT_DIR}/Include/pvd/PxPvdSceneClient.h
)
SOURCE_GROUP(include\\pvd FILES ${PHYSX_PVD_HEADERS})

SET(PHYSX_METADATA_HEADERS
	${MD_SOURCE_DIR}/core/include/PvdMetaDataDefineProperties.h
	${MD_SOURCE_DIR}/core/include/PvdMetaDataExtensions.h
	${MD_SOURCE_DIR}/core/include/PvdMetaDataPropertyVisitor.h
	${MD_SOURCE_DIR}/core/include/PxAutoGeneratedMetaDataObjectNames.h
	${MD_SOURCE_DIR}/core/include/PxAutoGeneratedMetaDataObjects.h
	${MD_SOURCE_DIR}/core/include/PxMetaDataCompare.h
	${MD_SOURCE_DIR}/core/include/PxMetaDataCppPrefix.h
	${MD_SOURCE_DIR}/core/include/PxMetaDataObjects.h
	${MD_SOURCE_DIR}/core/include/RepXMetaDataPropertyVisitor.h
)
SOURCE_GROUP(metadata\\include FILES ${PHYSX_METADATA_HEADERS})

SET(PHYSX_METADATA_SOURCE
	${MD_SOURCE_DIR}/core/src/PxAutoGeneratedMetaDataObjects.cpp
	${MD_SOURCE_DIR}/core/src/PxMetaDataObjects.cpp
)
SOURCE_GROUP(metadata\\src FILES ${PHYSX_METADATA_SOURCE})

SET(PHYSX_IMMEDIATEMODE_SOURCE
	${PHYSX_ROOT_DIR}/Source/ImmediateMode/src/NpImmediateMode.cpp
)
SOURCE_GROUP(src\\immediatemode FILES ${PHYSX_IMMEDIATEMODE_SOURCE})

SET(PHYSX_BUFFERING_SOURCE
	${PX_SOURCE_DIR}/buffering/ScbActor.cpp
	${PX_SOURCE_DIR}/buffering/ScbAggregate.cpp
	${PX_SOURCE_DIR}/buffering/ScbBase.cpp
	${PX_SOURCE_DIR}/buffering/ScbCloth.cpp
	${PX_SOURCE_DIR}/buffering/ScbMetaData.cpp
	${PX_SOURCE_DIR}/buffering/ScbParticleSystem.cpp
	${PX_SOURCE_DIR}/buffering/ScbScene.cpp
	${PX_SOURCE_DIR}/buffering/ScbScenePvdClient.cpp
	${PX_SOURCE_DIR}/buffering/ScbShape.cpp
	${PX_SOURCE_DIR}/buffering/ScbActor.h
	${PX_SOURCE_DIR}/buffering/ScbAggregate.h
	${PX_SOURCE_DIR}/buffering/ScbArticulation.h
	${PX_SOURCE_DIR}/buffering/ScbArticulationJoint.h
	${PX_SOURCE_DIR}/buffering/ScbBase.h
	${PX_SOURCE_DIR}/buffering/ScbBody.h
	${PX_SOURCE_DIR}/buffering/ScbCloth.h
	${PX_SOURCE_DIR}/buffering/ScbConstraint.h
	${PX_SOURCE_DIR}/buffering/ScbDefs.h
	${PX_SOURCE_DIR}/buffering/ScbNpDeps.h
	${PX_SOURCE_DIR}/buffering/ScbParticleSystem.h
	${PX_SOURCE_DIR}/buffering/ScbRigidObject.h
	${PX_SOURCE_DIR}/buffering/ScbRigidStatic.h
	${PX_SOURCE_DIR}/buffering/ScbScene.h
	${PX_SOURCE_DIR}/buffering/ScbSceneBuffer.h
	${PX_SOURCE_DIR}/buffering/ScbScenePvdClient.h
	${PX_SOURCE_DIR}/buffering/ScbShape.h
	${PX_SOURCE_DIR}/buffering/ScbType.h
)
SOURCE_GROUP(src\\buffering FILES ${PHYSX_BUFFERING_SOURCE})

SET(PHYSX_CLOTH_SOURCE
	${PX_SOURCE_DIR}/cloth/NpCloth.cpp
	${PX_SOURCE_DIR}/cloth/NpClothFabric.cpp
	${PX_SOURCE_DIR}/cloth/NpClothParticleData.cpp
	${PX_SOURCE_DIR}/cloth/NpCloth.h
	${PX_SOURCE_DIR}/cloth/NpClothFabric.h
	${PX_SOURCE_DIR}/cloth/NpClothParticleData.h
)
SOURCE_GROUP(src\\cloth FILES ${PHYSX_CLOTH_SOURCE})

SET(PHYSX_PARTICLES_SOURCE
	${PX_SOURCE_DIR}/particles/NpParticleFluid.cpp
	${PX_SOURCE_DIR}/particles/NpParticleSystem.cpp
	${PX_SOURCE_DIR}/particles/NpParticleBaseTemplate.h
	${PX_SOURCE_DIR}/particles/NpParticleFluid.h
	${PX_SOURCE_DIR}/particles/NpParticleFluidReadData.h
	${PX_SOURCE_DIR}/particles/NpParticleSystem.h	
)
SOURCE_GROUP(src\\particles FILES ${PHYSX_PARTICLES_SOURCE})

SET(PHYSX_CORE_SOURCE
	${PX_SOURCE_DIR}/NpActor.cpp
	${PX_SOURCE_DIR}/NpAggregate.cpp
	${PX_SOURCE_DIR}/NpArticulation.cpp
	${PX_SOURCE_DIR}/NpArticulationJoint.cpp
	${PX_SOURCE_DIR}/NpArticulationLink.cpp
	${PX_SOURCE_DIR}/NpBatchQuery.cpp
	${PX_SOURCE_DIR}/NpConstraint.cpp
	${PX_SOURCE_DIR}/NpFactory.cpp
	${PX_SOURCE_DIR}/NpMaterial.cpp
	${PX_SOURCE_DIR}/NpMetaData.cpp
	${PX_SOURCE_DIR}/NpPhysics.cpp
	${PX_SOURCE_DIR}/NpPvdSceneQueryCollector.cpp
	${PX_SOURCE_DIR}/NpReadCheck.cpp
	${PX_SOURCE_DIR}/NpRigidDynamic.cpp
	${PX_SOURCE_DIR}/NpRigidStatic.cpp
	${PX_SOURCE_DIR}/NpScene.cpp
	${PX_SOURCE_DIR}/NpSceneQueries.cpp
	${PX_SOURCE_DIR}/NpSerializerAdapter.cpp
	${PX_SOURCE_DIR}/NpShape.cpp
	${PX_SOURCE_DIR}/NpShapeManager.cpp
	${PX_SOURCE_DIR}/NpSpatialIndex.cpp
	${PX_SOURCE_DIR}/NpVolumeCache.cpp
	${PX_SOURCE_DIR}/NpWriteCheck.cpp
	${PX_SOURCE_DIR}/PvdMetaDataPvdBinding.cpp
	${PX_SOURCE_DIR}/PvdPhysicsClient.cpp
	${PX_SOURCE_DIR}/NpActor.h
	${PX_SOURCE_DIR}/NpActorTemplate.h
	${PX_SOURCE_DIR}/NpAggregate.h
	${PX_SOURCE_DIR}/NpArticulation.h
	${PX_SOURCE_DIR}/NpArticulationJoint.h
	${PX_SOURCE_DIR}/NpArticulationLink.h
	${PX_SOURCE_DIR}/NpBatchQuery.h
	${PX_SOURCE_DIR}/NpCast.h
	${PX_SOURCE_DIR}/NpConnector.h
	${PX_SOURCE_DIR}/NpConstraint.h
	${PX_SOURCE_DIR}/NpFactory.h
	${PX_SOURCE_DIR}/NpMaterial.h
	${PX_SOURCE_DIR}/NpMaterialManager.h
	${PX_SOURCE_DIR}/NpPhysics.h
	${PX_SOURCE_DIR}/NpPhysicsInsertionCallback.h
	${PX_SOURCE_DIR}/NpPtrTableStorageManager.h
	${PX_SOURCE_DIR}/NpPvdSceneQueryCollector.h
	${PX_SOURCE_DIR}/NpQueryShared.h
	${PX_SOURCE_DIR}/NpReadCheck.h
	${PX_SOURCE_DIR}/NpRigidActorTemplate.h
	${PX_SOURCE_DIR}/NpRigidActorTemplateInternal.h
	${PX_SOURCE_DIR}/NpRigidBodyTemplate.h
	${PX_SOURCE_DIR}/NpRigidDynamic.h
	${PX_SOURCE_DIR}/NpRigidStatic.h
	${PX_SOURCE_DIR}/NpScene.h
	${PX_SOURCE_DIR}/NpSceneQueries.h
	${PX_SOURCE_DIR}/NpShape.h
	${PX_SOURCE_DIR}/NpShapeManager.h
	${PX_SOURCE_DIR}/NpSpatialIndex.h
	${PX_SOURCE_DIR}/NpVolumeCache.h
	${PX_SOURCE_DIR}/NpWriteCheck.h
	${PX_SOURCE_DIR}/PvdMetaDataBindingData.h
	${PX_SOURCE_DIR}/PvdMetaDataPvdBinding.h
	${PX_SOURCE_DIR}/PvdPhysicsClient.h
	${PX_SOURCE_DIR}/PvdTypeNames.h
)
SOURCE_GROUP(src FILES ${PHYSX_CORE_SOURCE})

ADD_LIBRARY(PhysX ${PHYSX_LIBTYPE}
	${PHYSX_HEADERS}
	${PHYSX_CLOTH_HEADERS}
	${PHYSX_COMMON_HEADERS}
	${PHYSX_PARTICLES_HEADERS}
	${PHYSX_PVD_HEADERS}
	
	${PHYSX_METADATA_HEADERS}
	${PHYSX_METADATA_SOURCE}
	
	${PHYSX_CORE_SOURCE}
	${PHYSX_CLOTH_SOURCE}
	${PHYSX_BUFFERING_SOURCE}
	${PHYSX_IMMEDIATEMODE_SOURCE}
	${PHYSX_PARTICLES_SOURCE}
	
	${PHYSX_PLATFORM_SRC_FILES}	
)

TARGET_INCLUDE_DIRECTORIES(PhysX 
	PRIVATE ${PHYSX_PLATFORM_INCLUDES}
	PRIVATE ${PXSHARED_ROOT_DIR}/include
	PRIVATE ${PXSHARED_ROOT_DIR}/src/foundation/include
	PRIVATE ${PXSHARED_ROOT_DIR}/src/fastxml/include
	PRIVATE ${PXSHARED_ROOT_DIR}/src/pvd/include

	PRIVATE ${PHYSX_ROOT_DIR}/Include
	PRIVATE ${PHYSX_ROOT_DIR}/Include/gpu
	PRIVATE ${PHYSX_ROOT_DIR}/Include/common
	PRIVATE ${PHYSX_ROOT_DIR}/Include/geometry
	PRIVATE ${PHYSX_ROOT_DIR}/Include/pvd
	PRIVATE ${PHYSX_ROOT_DIR}/Include/particles
	PRIVATE ${PHYSX_ROOT_DIR}/Include/cloth
	PRIVATE ${PHYSX_ROOT_DIR}/Include/GeomUtils

	PRIVATE ${PHYSX_SOURCE_DIR}/Common/include
	PRIVATE ${PHYSX_SOURCE_DIR}/Common/src

	PRIVATE ${PHYSX_SOURCE_DIR}/PhysX/src
	PRIVATE ${PHYSX_SOURCE_DIR}/PhysX/src/device
	PRIVATE ${PHYSX_SOURCE_DIR}/PhysX/src/buffering
	PRIVATE ${PHYSX_SOURCE_DIR}/PhysX/src/particles
	PRIVATE ${PHYSX_SOURCE_DIR}/PhysX/src/cloth

	PRIVATE ${PHYSX_SOURCE_DIR}/PhysXGpu/include
	
	PRIVATE ${PHYSX_SOURCE_DIR}/PhysXProfile/include
	PRIVATE ${PHYSX_SOURCE_DIR}/PhysXProfile/src
	
	PRIVATE ${PHYSX_SOURCE_DIR}/GeomUtils/headers
	PRIVATE ${PHYSX_SOURCE_DIR}/GeomUtils/src
	PRIVATE ${PHYSX_SOURCE_DIR}/GeomUtils/src/contact
	PRIVATE ${PHYSX_SOURCE_DIR}/GeomUtils/src/common
	PRIVATE ${PHYSX_SOURCE_DIR}/GeomUtils/src/convex
	PRIVATE ${PHYSX_SOURCE_DIR}/GeomUtils/src/distance
	PRIVATE ${PHYSX_SOURCE_DIR}/GeomUtils/src/sweep
	PRIVATE ${PHYSX_SOURCE_DIR}/GeomUtils/src/gjk
	PRIVATE ${PHYSX_SOURCE_DIR}/GeomUtils/src/intersection
	PRIVATE ${PHYSX_SOURCE_DIR}/GeomUtils/src/mesh
	PRIVATE ${PHYSX_SOURCE_DIR}/GeomUtils/src/hf
	PRIVATE ${PHYSX_SOURCE_DIR}/GeomUtils/src/pcm
	PRIVATE ${PHYSX_SOURCE_DIR}/GeomUtils/src/ccd
	
	PRIVATE ${PHYSX_SOURCE_DIR}/LowLevel/API/include
	PRIVATE ${PHYSX_SOURCE_DIR}/LowLevel/software/include
	PRIVATE ${PHYSX_SOURCE_DIR}/LowLevel/common/include/pipeline

	PRIVATE ${PHYSX_SOURCE_DIR}/LowLevelAABB/include
	
	PRIVATE ${PHYSX_SOURCE_DIR}/LowLevelDynamics/include

	PRIVATE ${PHYSX_SOURCE_DIR}/LowLevelParticles/include
	
	PRIVATE ${PHYSX_SOURCE_DIR}/SimulationController/include
	PRIVATE ${PHYSX_SOURCE_DIR}/SimulationController/src
	PRIVATE ${PHYSX_SOURCE_DIR}/SimulationController/src/particles
	
	PRIVATE ${PHYSX_SOURCE_DIR}/PhysXCooking/src
	PRIVATE ${PHYSX_SOURCE_DIR}/PhysXCooking/src/mesh
	PRIVATE ${PHYSX_SOURCE_DIR}/PhysXCooking/src/convex
	
	PRIVATE ${PHYSX_SOURCE_DIR}/SceneQuery/include
	
	PRIVATE ${PHYSX_SOURCE_DIR}/PhysXMetaData/core/include

    PRIVATE ${PHYSX_SOURCE_DIR}/ImmediateMode/include
)

TARGET_COMPILE_DEFINITIONS(PhysX 

	# Common to all configurations
	PRIVATE ${PHYSX_COMPILE_DEFS}
)

SET_TARGET_PROPERTIES(PhysX PROPERTIES
	OUTPUT_NAME PhysX3

)

SET_TARGET_PROPERTIES(PhysX PROPERTIES 
	COMPILE_PDB_NAME_DEBUG "PhysX3${CMAKE_DEBUG_POSTFIX}"
	COMPILE_PDB_NAME_CHECKED "PhysX3${CMAKE_CHECKED_POSTFIX}"
	COMPILE_PDB_NAME_PROFILE "PhysX3${CMAKE_PROFILE_POSTFIX}"
	COMPILE_PDB_NAME_RELEASE "PhysX3${CMAKE_RELEASE_POSTFIX}"
)